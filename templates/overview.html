{% extends "base.html" %}

{% block title %}Overview - Energy Dashboard{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1 class="page-title">Energy Overview</h1>
    <p class="page-subtitle">Real-time snapshot of your energy consumption</p>
</div>

<!-- Stat Cards Grid -->
<div class="stat-grid">
    <!-- Total Power -->
    <div class="stat-card">
        <div class="stat-icon">âš¡</div>
        <div class="stat-value">
            {% if data and data.total_power %}
                {{ "%.2f"|format(data.total_power) }}
            {% else %}
                0.00
            {% endif %}
        </div>
        <div class="stat-label">Current Power (W)</div>
    </div>

    <!-- Daily Energy -->
    <div class="stat-card">
        <div class="stat-icon">ðŸ“Š</div>
        <div class="stat-value">
            {% if data and data.daily_energy %}
                {{ "%.2f"|format(data.daily_energy) }}
            {% else %}
                0.00
            {% endif %}
        </div>
        <div class="stat-label">Today's Energy (kWh)</div>
    </div>

    <!-- Daily Cost -->
    <div class="stat-card">
        <div class="stat-icon">ðŸ’°</div>
        <div class="stat-value">
            {% if data and data.daily_cost %}
                {{ config.CURRENCY_SYMBOL }}{{ "%.2f"|format(data.daily_cost) }}
            {% elif data and data.daily_energy and config %}
                {{ config.CURRENCY_SYMBOL }}{{ "%.2f"|format(data.daily_energy * config.ELECTRICITY_RATE) }}
            {% else %}
                {{ config.CURRENCY_SYMBOL }}0.00
            {% endif %}
        </div>
        <div class="stat-label">Today's Cost</div>
    </div>

    <!-- Active Devices -->
    <div class="stat-card">
        <div class="stat-icon">ðŸ”Œ</div>
        <div class="stat-value">
            {% if data and data.device_count %}
                {{ data.device_count }}
            {% else %}
                0
            {% endif %}
        </div>
        <div class="stat-label">Active Devices</div>
    </div>
</div>

<!-- Power Usage Gauge -->
<div class="main-card">
    <div class="main-card-header">
        <h2 class="main-card-title">Power Usage</h2>
    </div>
    <div id="powerGaugeChart" style="width: 100%; height: 200px;"></div>
</div>

<!-- Quick Navigation -->
<div class="main-card">
    <h2 class="main-card-title">Quick Access</h2>
    <div class="quick-access-grid" style="margin-top: var(--space-4);">
        <a href="{{ url_for('realtime') }}" class="quick-link">
            <div class="quick-link-icon">âš¡</div>
            <div class="quick-link-content">
                <div class="quick-link-title">Real-time Monitor</div>
                <div class="quick-link-description">View current power usage</div>
            </div>
        </a>
        <a href="{{ url_for('costs') }}" class="quick-link">
            <div class="quick-link-icon">ðŸ’°</div>
            <div class="quick-link-content">
                <div class="quick-link-title">Cost Analysis</div>
                <div class="quick-link-description">Analyze energy costs</div>
            </div>
        </a>
        <a href="{{ url_for('history') }}" class="quick-link">
            <div class="quick-link-icon">ðŸ“ˆ</div>
            <div class="quick-link-content">
                <div class="quick-link-title">Historical Trends</div>
                <div class="quick-link-description">View usage patterns</div>
            </div>
        </a>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const powerValue = {{ data.total_power if data and data.total_power else 0 }};
    const maxPower = 3000;
    const primaryColor = getComputedStyle(document.documentElement).getPropertyValue('--color-primary').trim();
    
    const chart = echarts.init(document.getElementById('powerGaugeChart'));
    
    const option = {
        series: [{
            type: 'gauge',
            startAngle: 180,
            endAngle: 0,
            min: 0,
            max: maxPower,
            splitNumber: 6,
            radius: '90%',
            center: ['50%', '70%'],
            axisLine: {
                lineStyle: {
                    width: 25,
                    color: [
                        [powerValue/maxPower, primaryColor],
                        [1, '#E0E0E0']
                    ]
                }
            },
            pointer: {
                itemStyle: {
                    color: primaryColor
                },
                length: '70%'
            },
            axisTick: {
                show: false
            },
            splitLine: {
                distance: -25,
                length: 25,
                lineStyle: {
                    color: '#fff',
                    width: 2
                }
            },
            axisLabel: {
                distance: 10,
                color: 'var(--text-muted)',
                fontSize: 11,
                formatter: function(value) {
                    return value.toFixed(0);
                }
            },
            detail: {
                valueAnimation: true,
                formatter: '{value} W',
                color: 'var(--text-primary)',
                fontSize: 32,
                fontWeight: 'bold',
                offsetCenter: [0, '0%']
            },
            data: [{value: powerValue}]
        }]
    };
    
    chart.setOption(option);
    
    window.addEventListener('resize', function() {
        chart.resize();
    });
});
</script>
{% endblock %}
