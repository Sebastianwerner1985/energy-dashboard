{% extends "base.html" %}

{% block title %}Overview - Energy Dashboard{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1 class="page-title">Energy Overview</h1>
    <p class="page-subtitle">Real-time snapshot of your energy consumption</p>
</div>

<!-- Stat Cards Grid -->
<div class="stat-grid">
    <!-- Total Power -->
    <div class="stat-card">
        <div class="stat-icon">âš¡</div>
        <div class="stat-value">
            {% if data and data.total_power %}
                {{ "%.2f"|format(data.total_power) }}
            {% else %}
                0.00
            {% endif %}
        </div>
        <div class="stat-label">Current Power (W)</div>
    </div>

    <!-- Daily Energy -->
    <div class="stat-card">
        <div class="stat-icon">ðŸ“Š</div>
        <div class="stat-value">
            {% if data and data.daily_energy %}
                {{ "%.2f"|format(data.daily_energy) }}
            {% else %}
                0.00
            {% endif %}
        </div>
        <div class="stat-label">Today's Energy (kWh)</div>
    </div>

    <!-- Daily Cost -->
    <div class="stat-card">
        <div class="stat-icon">ðŸ’°</div>
        <div class="stat-value">
            {% if data and data.daily_cost %}
                {{ config.CURRENCY_SYMBOL }}{{ "%.2f"|format(data.daily_cost) }}
            {% elif data and data.daily_energy and config %}
                {{ config.CURRENCY_SYMBOL }}{{ "%.2f"|format(data.daily_energy * config.ELECTRICITY_RATE) }}
            {% else %}
                {{ config.CURRENCY_SYMBOL }}0.00
            {% endif %}
        </div>
        <div class="stat-label">Today's Cost</div>
    </div>

    <!-- Active Devices -->
    <div class="stat-card">
        <div class="stat-icon">ðŸ”Œ</div>
        <div class="stat-value">
            {% if data and data.device_count %}
                {{ data.device_count }}
            {% else %}
                0
            {% endif %}
        </div>
        <div class="stat-label">Active Devices</div>
    </div>
</div>

<!-- Power Usage Gauge -->
<div class="main-card">
    <div class="main-card-header">
        <h2 class="main-card-title">Power Usage</h2>
    </div>
    <div class="chart-container">
        <canvas id="powerGaugeChart" style="max-height: 200px;"></canvas>
    </div>
</div>

<!-- Quick Navigation -->
<div class="main-card">
    <h2 class="main-card-title">Quick Access</h2>
    <div class="quick-access-grid" style="margin-top: var(--space-4);">
        <a href="{{ url_for('realtime') }}" class="quick-link">
            <div class="quick-link-icon">âš¡</div>
            <div class="quick-link-content">
                <div class="quick-link-title">Real-time Monitor</div>
                <div class="quick-link-description">View current power usage</div>
            </div>
        </a>
        <a href="{{ url_for('costs') }}" class="quick-link">
            <div class="quick-link-icon">ðŸ’°</div>
            <div class="quick-link-content">
                <div class="quick-link-title">Cost Analysis</div>
                <div class="quick-link-description">Analyze energy costs</div>
            </div>
        </a>
        <a href="{{ url_for('history') }}" class="quick-link">
            <div class="quick-link-icon">ðŸ“ˆ</div>
            <div class="quick-link-content">
                <div class="quick-link-title">Historical Trends</div>
                <div class="quick-link-description">View usage patterns</div>
            </div>
        </a>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    // Get SnowUI colors
    const root = document.documentElement;
    const primaryColor = getComputedStyle(root).getPropertyValue('--color-primary').trim();
    const surfaceColor = getComputedStyle(root).getPropertyValue('--bg-surface').trim();

    // Power Gauge Chart
    const powerValue = {{ data.total_power if data and data.total_power else 0 }};
    const maxPower = 5000; // Maximum expected power in watts

    const gaugeData = {
        datasets: [{
            data: [powerValue, maxPower - powerValue],
            backgroundColor: [primaryColor, surfaceColor],
            borderWidth: 0
        }]
    };

    const gaugeConfig = {
        type: 'doughnut',
        data: gaugeData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            circumference: 180,
            rotation: 270,
            cutout: '75%',
            layout: {
                padding: 0
            },
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    enabled: false
                }
            }
        },
        plugins: [{
            id: 'gaugeText',
            afterDraw: (chart) => {
                const ctx = chart.ctx;
                const centerX = chart.chartArea.left + (chart.chartArea.right - chart.chartArea.left) / 2;
                const centerY = chart.chartArea.top + (chart.chartArea.bottom - chart.chartArea.top) / 2 + 20;

                ctx.save();
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.font = 'bold 32px Inter';
                ctx.fillStyle = getComputedStyle(root).getPropertyValue('--text-primary').trim();
                ctx.fillText(powerValue.toFixed(0) + ' W', centerX, centerY);
                ctx.restore();
            }
        }]
    };

    // Create chart when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
        const ctx = document.getElementById('powerGaugeChart');
        if (ctx) {
            new Chart(ctx, gaugeConfig);
        }
    });
</script>
{% endblock %}
